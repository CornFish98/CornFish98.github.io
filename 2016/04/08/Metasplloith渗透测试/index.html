<!DOCTYPE html>
<!--[if lte IE 8 ]>
<html class="ie" xmlns="http://www.w3.org/1999/xhtml" xml:lang="en-US" lang="en-US">
<![endif]-->
<!--[if (gte IE 9)|!(IE)]><!-->
<!--
***************  *      *     *
      8          *    *       *
      8          *  *         *
      8          **           *
      8          *  *         *
      8          *    *       *
      8          *      *     *
      8          *        *   ***********    -----Theme By Kieran(http://go.kieran.top)
-->
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en-US" lang="en-US">
<!--<![endif]-->

<head>
  <title>Metasplloith渗透测试 | CornFish</title>
  <!-- Meta data -->
    <meta http-equiv="Content-Type" content="text/html" charset="UTF-8" >
    <meta http-equiv="X-UA-Compatible" content="IE=edge"/>
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta name="generator" content="CornFish">
    <meta name="author" content="ZKY">
    <meta name="description" content="" />
    <meta name="keywords" content="" />

    <!-- Favicon, (keep icon in root folder) -->
    <link rel="Shortcut Icon" href="/img/favicon.ico" type="image/ico">

    <link rel="alternate" href="/atom.xml" title="CornFish" type="application/atom+xml">
    <link rel="stylesheet" href="/css/all.css" media="screen" type="text/css">
	
    <link rel="stylesheet" href="/highlightjs/vs.css" type="text/css">
    
    

    <!-- Custom stylesheet, (add custom styles here, always load last) -->
    <!-- Load our stylesheet for IE8 -->
    <!--[if IE 8]>
    <link rel="stylesheet" type="text/css" href="/css/ie8.css" />
    <![endif]-->

    <!-- Google Webfonts (Monserrat 400/700, Open Sans 400/600) -->
    <link href='//fonts.useso.com/css?family=Montserrat:400,700' rel='stylesheet' type='text/css'>
    <link href='//fonts.useso.com/css?family=Open+Sans:400,600' rel='stylesheet' type='text/css'>

    <!-- Load our fonts individually if IE8+, to avoid faux bold & italic rendering -->
    <!--[if IE]>
    <link href='http://fonts.useso.com/css?family=Montserrat:400' rel='stylesheet' type='text/css'>
    <link href='http://fonts.useso.com/css?family=Montserrat:700' rel='stylesheet' type='text/css'>
    <link href='http://fonts.useso.com/css?family=Open+Sans:400' rel='stylesheet' type='text/css'>
    <link href='http://fonts.useso.com/css?family=Open+Sans:600' rel='stylesheet' type='text/css'>
    <![endif]-->

    <!-- jQuery | Load our jQuery, with an alternative source fallback to a local version if request is unavailable -->
    <script src="/js/jquery-1.11.1.min.js"></script>
    <script>window.jQuery || document.write('<script src="js/jquery-1.11.1.min.js"><\/script>')</script>

    <!-- Load these in the <head> for quicker IE8+ load times -->
    <!-- HTML5 shim and Respond.js IE8 support of HTML5 elements and media queries -->
    <!--[if lt IE 9]>
    <script src="/js/html5shiv.min.js"></script>
    <script src="/js/respond.min.js"></script>
    <![endif]-->










  
  
  

  
  <style>.col-md-8.col-md-offset-2.opening-statement img{display:none;}</style>
</head>

<!--
<body class="post-template">
-->
<body id="index" class="lightnav animsition">

      <!-- ============================ Off-canvas navigation =========================== -->

    <div class="sb-slidebar sb-right sb-style-overlay sb-momentum-scrolling">
        <div class="sb-close" aria-label="Close Menu" aria-hidden="true">
            <img src="/img/close.png" alt="Close"/>
        </div>
        <!-- Lists in Slidebars -->
        <ul class="sb-menu">
            <li><a href="/" class="animsition-link" title="Home">Home</a></li>
            <li><a href="/archives" class="animsition-link" title="archive">archives</a></li>
            <!-- Dropdown Menu -->
			 
            <li>
                <a class="sb-toggle-submenu">Works<span class="sb-caret"></span></a>
                <ul class="sb-submenu">
                    
                        <li><a href="http://cornfish98.com" target="_BLANK" class="animsition-link">MyBlog</a></li>
                    
                </ul>
            </li>
            
            
        	<li>
        		<a class="sb-toggle-submenu">Categories<span class="sb-caret"></span></a>
            	<ul class="sb-submenu">
				  	
				    <li><a href="/categories/C/" class="animsition-link">C++<small>(6)</small></a></li>
				    
				    <li><a href="/categories/Computer-Networking/" class="animsition-link">Computer Networking<small>(1)</small></a></li>
				    
				    <li><a href="/categories/Data-Structure-and-Algorithms/" class="animsition-link">Data Structure and Algorithms<small>(1)</small></a></li>
				    
				    <li><a href="/categories/Information-Security/" class="animsition-link">Information Security<small>(1)</small></a></li>
				    
				    <li><a href="/categories/LeetCode/" class="animsition-link">LeetCode<small>(4)</small></a></li>
				    
				</ul>
        	</li>
			
            
            <li>
                <a class="sb-toggle-submenu">Links<span class="sb-caret"></span></a>
                <ul class="sb-submenu">
                    
                    <li><a href="http://www.cornfish98.com/" class="animsition-link">ZKY</a></li>
                    
                </ul>
            </li>
            
        </ul>
        <!-- Lists in Slidebars -->
        <ul class="sb-menu secondary">
            <li><a href="/about.html" class="animsition-link" title="about">About</a></li>
            <li><a href="/atom.xml" class="animsition-link" title="rss">RSS</a></li>
        </ul>
    </div>
    
    <!-- ============================ END Off-canvas navigation =========================== -->

    <!-- ============================ #sb-site Main Page Wrapper =========================== -->

    <div id="sb-site">
        <!-- #sb-site - All page content should be contained within this id, except the off-canvas navigation itself -->

        <!-- ============================ Header & Logo bar =========================== -->

        <div id="navigation" class="navbar navbar-fixed-top">
            <div class="navbar-inner">
                <div class="container">
                    <!-- Nav logo -->
                    <div class="logo">
                        <a href="/" title="Logo" class="animsition-link">
                        
                        </a>
                    </div>
                    <!-- // Nav logo -->
                    <!-- Info-bar -->
                    <nav>
                        <ul class="nav">
                            <li><a href="/" class="animsition-link">CornFish</a></li>
                            <li class="nolink">一年一年，一天一念</li>
                            
                            <li><a href="https://github.com/" title="Github" target="_blank"><i class="icon-github"></i></a></li>
                            
                            
                            
                            
                            <li><a href="https://google.com/" title="Google-Plus" target="_blank"><i class="icon-google-plus"></i></a></li>
                            
                            
                            <li><a href="http://weibo.com/" title="Sina-Weibo" target="_blank"><i class="icon-sina-weibo"></i></a></li>
                            
                            <li class="nolink"><span></span></li>
                        </ul>
                    </nav>
                    <!--// Info-bar -->
                </div>
                <!-- // .container -->
                <div class="learnmore sb-toggle-right">More</div>
                <button type="button" class="navbar-toggle menu-icon sb-toggle-right" title="More">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar before"></span>
                <span class="icon-bar main"></span>
                <span class="icon-bar after"></span>
                </button>
            </div>
            <!-- // .navbar-inner -->
        </div>

        <!-- ============================ Header & Logo bar =========================== -->

        <!-- ============================ Hero Image =========================== -->

        <section id="hero" class="scrollme">
            <div class="container-fluid element-img" style="background: url(/img/bg_img.jpg) no-repeat center center fixed;background-size: cover">
                <div class="row">
                    <div class="col-xs-12 col-sm-8 col-sm-offset-2 col-md-8 col-md-offset-2 vertical-align cover boost text-center">
                        <div class="center-me animateme" data-when="exit" data-from="0" data-to="0.6" data-opacity="0" data-translatey="100">
                            <div>
                            	
                                <h2>Welcome to Cornfish's blog!</h2>
                                <p></p>
				    			
                                <h2></h2>
                                <p>每一个不曾起舞的日子都是对生命的辜负。</p>
				    			

                            </div>
                        </div>
                    </div>
                    <!-- // .col-md-12 -->
                </div>
                <div class="herofade beige-dk"></div>
            </div>
        </section>

        <!-- Height spacing helper -->
        <div class="heightblock"></div>
        <!-- // End height spacing helper -->

        <!-- ============================ END Hero Image =========================== -->
      
<section id="intro">
    <div class="container">
        <div class="row col-md-offset-2">
            <div class="col-md-8">
    			<span class="post-meta">
      <time datetime="2016-04-07T16:45:38.000Z" itemprop="datePublished">
          2016-04-08
      </time>
    
</span>
                <h1>Metasplloith渗透测试</h1>
            </div>
        </div>
        <div class="col-md-8 col-md-offset-2">
      		<h3 id="1-实验环境搭建"><a href="#1-实验环境搭建" class="headerlink" title="1 实验环境搭建"></a>1 实验环境搭建</h3><p>由于条件限制，实验在VMware Workstation 12下进行，共配置5台机，1台攻击主机，1台web服务器，1台后台服务器，1台网管服务器，1台内网客户机。其中前3台机在外网，客户机在内网。配置两块虚拟网卡：VMnet1(192.168.10.0/24)位Host-only模式，VMnet8VMnet1(10.10.10.0/24)位NAT模式，设置DHCP分配从128开始。</p>
<h4 id="1-1-拓扑结构及网络配置"><a href="#1-1-拓扑结构及网络配置" class="headerlink" title="1.1 拓扑结构及网络配置"></a>1.1 拓扑结构及网络配置</h4><p> <strong>拓扑结构及相关网络配置如下：</strong></p>
<blockquote>
<p>Attacker： Black track 5 r3 / attacker.dvssc.com / 10.10.10.128（DHCP）<br>Web Server： OWASP BWA（Broken Web Apps）/www.dvssc.com / 10.10.10.129（DHCP）<br>Backend Server：Windows Server 2003 / service.dvssc.com / 10.10.10.130（DHCP）<br>Gateway Server： Linux Ubuntu / gate.dvssc.com / 10.10.10.254（set） and 192.168.10.254<br>Client PC： Windows XP SP3 / intranet1.dvssc.com / 192.168.10.128（DHCP）</p>
<h4 id="1-2-主机系统配置"><a href="#1-2-主机系统配置" class="headerlink" title="1.2 主机系统配置"></a>1.2 主机系统配置</h4><p>每台机分配资源如下：<br>Black track 5 r3：CPU(2) \ RAM(1024MB) \ HDD(20GB)<br>OWASP BWA：CPU(1) \ RAM(1024MB) \ HDD(8GB)<br>Windows Server 2003：CPU(1) \ RAM(1024MB) \ HDD(40GB)<br>Linux Ubuntu：CPU(1) \ RAM(512MB) \ HDD(8GB)<br>Windows XP SP3：CPU(1) \ RAM(1024MB) \ HDD(40GB)</p>
<h4 id="1-3-配置网关"><a href="#1-3-配置网关" class="headerlink" title="1.3 配置网关"></a>1.3 配置网关</h4><p>要对网关做如下配置：<br>其中，使用命令：<strong>sudu vim/etc/network/interfaces</strong> 修改网卡配置文件<br><img src="http://7xrobr.com1.z0.glb.clouddn.com/2016-04-08-2-10.png" alt="2-10"></p>
</blockquote>
<p>配置路由功能：<br><strong>cd /etc</strong><br><strong>vim sysctl.conf</strong><br><img src="http://7xrobr.com1.z0.glb.clouddn.com/2016-04-08-3-2.png" alt="3-2"></p>
<p>设置转发规则：<br><img src="http://7xrobr.com1.z0.glb.clouddn.com/2016-04-08-3-3.png" alt="3-3"></p>
<h4 id="1-4-连通性测试"><a href="#1-4-连通性测试" class="headerlink" title="1.4 连通性测试"></a>1.4 连通性测试</h4><h3 id="2-实验"><a href="#2-实验" class="headerlink" title="2 实验"></a>2 实验</h3><h4 id="2-1-信息收集"><a href="#2-1-信息收集" class="headerlink" title="2.1 信息收集"></a>2.1 信息收集</h4><h5 id="2-1-1-通过DNS和IP地址挖掘目标网络信息"><a href="#2-1-1-通过DNS和IP地址挖掘目标网络信息" class="headerlink" title="2.1.1 通过DNS和IP地址挖掘目标网络信息"></a>2.1.1 通过DNS和IP地址挖掘目标网络信息</h5><blockquote>
<p>1 whois查询域名注册信息：<br><img src="http://7xrobr.com1.z0.glb.clouddn.com/2016-04-08-2-3.png" alt="2-3"></p>
<p>2 nslookup查询制定域名对应的IP地址（非权威解答）：<br>使用type=A对IP地址进行解析，使用type=MX查找其邮件转发服务器。<br><img src="http://7xrobr.com1.z0.glb.clouddn.com/2016-04-08-2-4.png" alt="2-4"></p>
<p>3 dig查询制定域名对应的IP地址（权威解答）：<br>命令格式为dig @DNS服务器  待查询的域名，可以在待查询的域名后加上A、NS、MX等选项查询特定DNS记录，默认为A。<br><img src="http://7xrobr.com1.z0.glb.clouddn.com/2016-04-08-2-5.png" alt="2-5"></p>
</blockquote>
<h5 id="2-1-2-借助站点服务"><a href="#2-1-2-借助站点服务" class="headerlink" title="2.1.2 借助站点服务"></a>2.1.2 借助站点服务</h5><p>另外，可以借助一些站点提供的服务：<br><a href="https://www.maxmind.com/zh/home" target="_blank" rel="external">IP2Location</a>询地理位置信息。<br><a href="http://www.ip-adress.com/" target="_blank" rel="external">IP2Domain</a>提供了IP Tracing    、Email Trace、IP Whois、Reverse IP等服务。</p>
<h5 id="2-1-3-google-Hacking"><a href="#2-1-3-google-Hacking" class="headerlink" title="2.1.3 google Hacking"></a>2.1.3 google Hacking</h5><p>两款google Hacking工具：<br><strong>siteDigger:</strong><br><img src="http://7xrobr.com1.z0.glb.clouddn.com/2016-04-08-2-1.png" alt="2-1"></p>
<p><strong>Search Digger:</strong><br><img src="http://7xrobr.com1.z0.glb.clouddn.com/2016-04-08-2-2.png" alt="2-2"></p>
<h5 id="2-1-4-使用metasploit中相关工具"><a href="#2-1-4-使用metasploit中相关工具" class="headerlink" title="2.1.4 使用metasploit中相关工具"></a>2.1.4 使用metasploit中相关工具</h5><p>使用metasploit中dir_scanner搜索目标网站目录：<br><img src="http://7xrobr.com1.z0.glb.clouddn.com/2016-04-08-2-6.png" alt="2-6"></p>
<p>使用metasploit中search_email_collector搜集制定网站的邮件地址：<br><img src="http://7xrobr.com1.z0.glb.clouddn.com/2016-04-08-2-7.png" alt="2-7"></p>
<h4 id="2-2-主机探测与端口扫描"><a href="#2-2-主机探测与端口扫描" class="headerlink" title="2.2 主机探测与端口扫描"></a>2.2 主机探测与端口扫描</h4><p>活跃主机指已连接到网络上、处于运行状态且网络功能正常的主机。通常网络上会有很多已关闭电源的主机或空闲（没有主机使用）的IP段，渗透测试者需要首先从大范围的IP地址段中寻找出活跃的主机，然后进一步筛选出感兴趣的目标主机。</p>
<h5 id="2-2-1-ICMP-Ping命令"><a href="#2-2-1-ICMP-Ping命令" class="headerlink" title="2.2.1 ICMP Ping命令"></a>2.2.1 ICMP Ping命令</h5><p>Ping（Packet Internet Grope，因特网包探索器）是一个用于测试网络连接的程序，由于它在网络管理维护工作中使用频率非常高，几乎所有操作系统都集成了这个程序。Ping程序会发送一个ICMP echo请求消息给目的主机，并报告应答情况，如果Ping后面跟的是域名，那么它首先会尝试将域名解析，然后向解析得到的IP地址发送数据包。前面的连通性测试中使用ping命令。</p>
<h5 id="2-2-2-使用metasploit的主机发现模块进行主机探测"><a href="#2-2-2-使用metasploit的主机发现模块进行主机探测" class="headerlink" title="2.2.2 使用metasploit的主机发现模块进行主机探测"></a>2.2.2 使用metasploit的主机发现模块进行主机探测</h5><p>Metasploit中提供了一些辅助模块可用于活跃主机的发现，这些模块位于Metasploit源码路径的modules/auxiliary/scanner/discovery/目录中，两个常用模块的主要功能为：arp_sweep使用ARP请求枚举本地局域网络中的所有活跃主机，udp_sweep通过发送UDP数据包探查指定主机是否活跃，并发现主机上的UDP服务。</p>
<p>在TCP/IP网络环境中，一台主机在发送数据帧前需要使用ARP（Address Resolution Protocol，地址解析协议）将目标IP地址转换成MAC地址，这个转换过程是通过发送一个ARP请求来完成的。如IP为A的主机发送一个ARP请求获取IP为B的MAC地址，此时如果IP为B的主机存在，那么它会向A发出一个回应。因此，可以通过发送ARP请求的方式很容易地获取同一子网上的活跃主机情况，这种技术也称为ARP扫描。<br><img src="http://7xrobr.com1.z0.glb.clouddn.com/2016-04-08-3-1.png" alt="3-1"></p>
<p>出现错误，解决方法：查看Interface设置是否正确。<br><img src="http://7xrobr.com1.z0.glb.clouddn.com/2016-04-08-3-5.png" alt="3-5"></p>
<p>注意show options中所列出的参数必须都赋值，否则会报错。<br><img src="http://7xrobr.com1.z0.glb.clouddn.com/2016-04-08-3-4.png" alt="3-4"></p>
<p>注：RHOSTS参数可使用连字符号（-）表示或使用无类型域间选路地址块（CIDR）表示。</p>
<h5 id="2-2-3-使用nmap扫描进行主机探测"><a href="#2-2-3-使用nmap扫描进行主机探测" class="headerlink" title="2.2.3 使用nmap扫描进行主机探测"></a>2.2.3 使用nmap扫描进行主机探测</h5><p>nmap命令参数较为繁杂，主要分为以下几类：TARGET SPECIFICATION（目标说明）、HOST DISCOVERY（主机发现）、SCAN TECHNIQUES（扫描技术）、PORT SPECIFICATION AND SCAN ORDER（端口说明和扫描顺序）、SERVICE/VERSION DETECTION（服务/版本检测）、SCRIPT SCAN（脚本扫描）、OS DETECTION（系统检测）、TIMING AND PERFORMANCE（时间和性能）、FIREWALL/IDS EVASION AND SPOOFING（防火墙/入侵检测系统躲避和欺骗）、OUTPUT（输出）、MISC（混杂）。<br>nmap命令格式为nmap+扫描选项+扫描目标，进行主机探测时常用参数如下：<br>在不适用任何选项的情况下，nmap会使用与ping一样的机制，向目标网络发送ICMP的echo请求，同时测试目标系统80端口和443端口是否打开。使用-sn命令仅扫描主机存活情况，而不进一步探测详细信息（不对开放的TCP端口进行扫描），可以加快扫描速度；使用-Pn选项会告诉nmap不使用ping扫描（因为通常ICMP包会被防火墙过滤，导致无法穿透网络边界）；-Pu选项对开放的udp端口进行探测确定主机是否存活（类似于udp_sweep）。<br><img src="http://7xrobr.com1.z0.glb.clouddn.com/2016-04-08-3-6.png" alt="3-6"></p>
<h5 id="2-2-4-使用nmap探测目标主机操作系统版本"><a href="#2-2-4-使用nmap探测目标主机操作系统版本" class="headerlink" title="2.2.4 使用nmap探测目标主机操作系统版本"></a>2.2.4 使用nmap探测目标主机操作系统版本</h5><p>进行操作系统辨识有着以下实际的意义：漏洞扫描器得到的扫描结果中一般会存在误报的现象，而准确的操作系统识别能让你排除这些误报项目。<br><img src="http://7xrobr.com1.z0.glb.clouddn.com/2016-04-08-3-7.png" alt="3-7"><br><img src="http://7xrobr.com1.z0.glb.clouddn.com/2016-04-08-3-8.png" alt="3-8"></p>
<h5 id="2-2-5-使用metasploit进行端口扫描与服务类型探测"><a href="#2-2-5-使用metasploit进行端口扫描与服务类型探测" class="headerlink" title="2.2.5 使用metasploit进行端口扫描与服务类型探测"></a>2.2.5 使用metasploit进行端口扫描与服务类型探测</h5><p>目前常见的端口扫描技术一般有如下几类：TCP Connect、TCP SYN、TCP ACK、TCP FIN，此外还有一些更为高级的端口扫描技术，如TCP IDLE。metasploit中的端口扫描器有：<br><img src="http://7xrobr.com1.z0.glb.clouddn.com/2016-04-08-3-9.png" alt="3-9"></p>
<p><strong>ack：</strong>通过ACK扫描的方式对防火墙上未被屏蔽的端口进行探测。<br><strong>ftpbounce：</strong>通过FTP bounce攻击的原理对TCP服务进行枚举，一些新的FTP服务器软件能够很好的防范FTP bounce攻击，但在一些旧的Solaris及FreeBSD系统的FTP服务中此类攻击方式仍能够被利用。<br><strong>syn：</strong>使用发送TCP SYN标志的方式探测开放的端口。<br><strong>tcp：</strong>通过一次完整的TCP连接来判断端口是否开放，这种扫描方式最准确，但扫描速度较慢。<br><strong>xmas：</strong>一种更为隐秘的扫描方式，通过发送FIN、PSH和URG标志，能够躲避一些高级的TCP标记监测器的过滤。</p>
<p>在一般的情况下，推荐使用syn端口扫描器，因为它的扫描速度较快、结果准确且不容易被对方察觉。<br><img src="http://7xrobr.com1.z0.glb.clouddn.com/2016-04-08-3-10.png" alt="3-10"></p>
<h5 id="2-2-6-使用nmap进行端口扫描与服务类型探测"><a href="#2-2-6-使用nmap进行端口扫描与服务类型探测" class="headerlink" title="2.2.6 使用nmap进行端口扫描与服务类型探测"></a>2.2.6 使用nmap进行端口扫描与服务类型探测</h5><p>Nmap对端口状态的分析粒度十分细致，共分为六个状态：open（开放）、closed（关闭）、filtered（被过滤）、unfiltered（未过滤）、open|filtered（开放或被过滤）、closed|filtered（关闭或被过滤）。<br>下面对这几种端口状态进行说明：</p>
<blockquote>
<p><strong>open：</strong>一个应用程序正在此端口上进行监听，以接收来自TCP、UDP或SCTP协议的数据。这是在渗透测试中最关注的一类端口，开放端口往往能够为我们提供一条能够进入系统的攻击路径。<br><strong>closed：</strong>关闭的端口指的是主机已响应，但没有应用程序监听的端口。这些信息并非毫无价值，扫描出关闭端口至少说明主机是活跃的。<br><strong>filtered：</strong>指Nmap不能确认端口是否开放，但根据响应数据猜测该端口可能被防火墙等设备过滤。<br><strong>unfiltered：</strong>仅在使用ACK扫描时，Nmap无法确定端口是否开放，会归为此类。可以使用其他类型的扫描（如Window扫描、SYN扫描、FIN扫描）进一步确认端口的信息。</p>
</blockquote>
<p>Nmap的参数可以分为扫描类型参数和扫描选项参数，扫描类型参数指定Nmap扫描实现机制，扫描选项则确定了Nmap执行扫描时的一些具体动作。</p>
<p><strong>常用的Nmap扫描类型参数主要有：</strong></p>
<blockquote>
<p>-sT：TCP connect扫描，类似Metasploit中的tcp扫描模块。<br>-sS：TCP SYN扫描，类似Metasploit中的syn扫描模块,这种扫描方式不等待打开一个完全的TCP连接，所以执行速度会更快，而且这种扫描通常不会被IDS等设备记录。<br>-sF/-sX/-sN：这些扫描通过发送一些特殊的标志位以避开设备或软件的监测。<br>-sP：通过发送ICMP echo请求探测主机是否存活，原理同Ping。<br>-sU：探测目标主机开放了哪些UDP端口。<br>-sA：TCP ACK扫描，类似Metasploit中的ack扫描模块。</p>
</blockquote>
<p><strong>常用的Nmap扫描选项有：</strong></p>
<blockquote>
<p>-Pn：在扫描之前，不发送ICMP echo请求测试目标是否活跃。<br>-O：启用对于TCP/IP协议栈的指纹特征扫描以获取远程主机的操作系统类型等信息。<br>-F：快速扫描模式，只扫描在nmap-services中列出的端口。<br>-p&lt;端口范围&gt;：可以使用这个参数指定希望扫描的端口，也可以使用一段端口范围（例如1～1023）。在IP协议扫描中（使用-sO参数），该参数的意义是指定想要扫描的协议号（0～255）。</p>
</blockquote>
<p><img src="http://7xrobr.com1.z0.glb.clouddn.com/2016-04-08-3-11.png" alt="3-11"></p>
<p>通过上面的端口扫描，已经得到了一些关于端口上开放哪些服务的简单信息，不过实际上Nmap只是简单地将开放的端口号与该端口上常见服务进行了一个映射，如果想要获取更加详细的服务版本等信息，需要使用-sV选项.</p>
<p><strong>10.10.10.129</strong><br><img src="http://7xrobr.com1.z0.glb.clouddn.com/2016-04-08-3-12.png" alt="3-12"></p>
<p><strong>10.10.10.130</strong><br><img src="http://7xrobr.com1.z0.glb.clouddn.com/2016-04-08-3-14.png" alt="3-14"></p>
<p><strong>192.168.10.128</strong><br><img src="http://7xrobr.com1.z0.glb.clouddn.com/2016-04-08-3-13.png" alt="3-13"></p>
<p><strong>10.10.10.254</strong><br><img src="http://7xrobr.com1.z0.glb.clouddn.com/2016-04-08-3-15.png" alt="3-15"></p>
<h4 id="2-3-服务扫描与查点"><a href="#2-3-服务扫描与查点" class="headerlink" title="2.3 服务扫描与查点"></a>2.3 服务扫描与查点</h4><p>确定开放端口后，通常会对相应端口上所运行服务的信息进行更深入的挖掘，通常称为服务查点。在Metasploit的Scanner辅助模块中，有很多用于服务扫描和查点的工具，这些工具通常以［service_name］_version和［service_name］_login命名。</p>
<p>［service_name］_version可用于遍历网络中包含了某种服务的主机，并进一步确定服务的版本。<br>［service_name］_login可对某种服务进行口令探测攻击。</p>
<p>如：http_version可用于查找网络中的Web服务器，并确定服务器的版本号，http_login可用于对需要身份认证的HTTP协议应用进行口令探测。可在msf下输入：search name：_version查看所有可用的服务查点模块。</p>
<h5 id="2-3-1-Telnet扫描"><a href="#2-3-1-Telnet扫描" class="headerlink" title="2.3.1 Telnet扫描"></a>2.3.1 Telnet扫描</h5><p>Telnet是一个历史悠久但先天缺乏安全性的网络服务。由于Telnet没有对传输的数据进行加密，越来越多的管理员渐渐使用更为安全的SSH协议代替它。但是，很多旧版的网络设备不支持SSH协议，而且管理员通常不愿冒风险升级他们重要设备的操作系统，所以网络上很多交换机、路由器甚至防火墙仍然在使用Telnet。一个有趣的现象是，价格昂贵、使用寿命更长的大型交换机使用Telnet协议的可能性会更大，而此类交换机在网络中的位置一般来说都非常重要。当渗透进入一个网络时，不妨扫描一下是否有主机或设备开启了Telnet服务，为下一步进行网络嗅探或口令猜测做好准备。<br><img src="http://7xrobr.com1.z0.glb.clouddn.com/2016-04-08-4-1.png" alt="4-1"></p>
<p>从结果中可以看出IP地址为10.10.10.254的主机（即网关服务器）开放了Telnet服务，通过返回的服务flag “Ubuntu 8.04\x0ametasploitable login：”，可以进一步确认出这台主机的操作系统版本为Ubuntu 8.04，而主机名为metasploitable。</p>
<h5 id="2-3-2-SSH扫描"><a href="#2-3-2-SSH扫描" class="headerlink" title="2.3.2 SSH扫描"></a>2.3.2 SSH扫描</h5><p>SSH是类UNIX系统上最常见的远程管理服务，与Telnet不同的是，它采用了安全的加密信息传输方式。通常管理员会使用SSH对服务器进行远程管理，服务器会向SSH客户端返回一个远程的Shell连接。如果没有做其他的安全增强配置（如限制管理登录的IP地址），只要获取服务器的登录口令，就可以使用SSH客户端登录服务器，那就相当于获得了相应登录用户的所有权限。<br><img src="http://7xrobr.com1.z0.glb.clouddn.com/2016-04-08-4-2.png" alt="4-2"></p>
<p>结果定位了两台开放SSH服务的主机，分别是10.10.10.129（网站服务器）和10.10.10.254（网关服务器），并且显示了SSH服务软件及具体版本号。</p>
<h5 id="2-3-3-Oracle数据库服务查点"><a href="#2-3-3-Oracle数据库服务查点" class="headerlink" title="2.3.3 Oracle数据库服务查点"></a>2.3.3 Oracle数据库服务查点</h5><p>各种网络数据库的网络服务端口是漏洞频发的“重灾区”，比如Microsoft SQL Server的1433端口，以及Oracle SQL监听器（tnslsnr）使用的1521端口。可以使用mssql_ping模块查找网络中的Microsoft SQL Server，使用tnslsnr_version模块查找网络中开放端口的Oracle监听器服务。<br><img src="http://7xrobr.com1.z0.glb.clouddn.com/2016-04-08-4-3.png" alt="4-3"></p>
<h5 id="2-3-4-开放代理探测与利用"><a href="#2-3-4-开放代理探测与利用" class="headerlink" title="2.3.4 开放代理探测与利用"></a>2.3.4 开放代理探测与利用</h5><p>隐藏自己的身份可以避免被对方的入侵检测系统跟踪。隐藏网络身份的技术很多，比如使用代理服务器（Proxy）、VPN等，不过最简单和最常见的还是使用代理服务器。Metasploit提供了open_proxy模块，能够方便地获取免费的HTTP代理服务器地址。获取免费开放代理之后，就可以在浏览器或者一些支持配置代理的渗透软件中配置代理，这可以在进行渗透测试时隐藏你的真实IP地址。<br><img src="http://7xrobr.com1.z0.glb.clouddn.com/2016-04-08-4-4.png" alt="4-4"></p>
<h5 id="2-3-5-SSH服务口令猜测"><a href="#2-3-5-SSH服务口令猜测" class="headerlink" title="2.3.5 SSH服务口令猜测"></a>2.3.5 SSH服务口令猜测</h5><p>对于发现的系统与文件管理类网络服务，比如Telnet、SSH、FTP等，可以进行弱口令的猜测，以及对明文传输口令的嗅探，从而尝试获取直接通过这些服务进入目标网络的通道。使用Metasploit中的ssh_login模块对SSH服务尝试进行口令试探攻击。进行口令攻击之前，需要一个好用的用户名和口令字典。<br><img src="http://7xrobr.com1.z0.glb.clouddn.com/2016-04-08-4-5.png" alt="4-5"></p>
<p>默认情况下，ssh_login模块还会尝试空口令，以及与用户名相同的弱口令进行登录测试。上图中结果表明网关服务器（Ubuntu Metasploitable）的root用户口令为ubuntu，通过这种方式直接获得了这台主机的远程访问Shell。</p>
<h5 id="2-3-5-psnuffle口令嗅探"><a href="#2-3-5-psnuffle口令嗅探" class="headerlink" title="2.3.5 psnuffle口令嗅探"></a>2.3.5 psnuffle口令嗅探</h5><p>在攻击机上运行Metasploit中的psnuffle模块，在10.10.10.0/24网段中进行监听，截获了访问网关服务器FTP服务的口令认证过程，从中可以发现FTP服务的用户名与口令为msfadmin:msfadmin。</p>
<p>web服务器登录ftp：<br><img src="http://7xrobr.com1.z0.glb.clouddn.com/2016-04-08-4-6.png" alt="4-6"></p>
<p>Attacker检测到结果：<br><img src="http://7xrobr.com1.z0.glb.clouddn.com/2016-04-08-4-7.png" alt="4-7"></p>
<h4 id="2-4-网络漏洞扫描"><a href="#2-4-网络漏洞扫描" class="headerlink" title="2.4 网络漏洞扫描"></a>2.4 网络漏洞扫描</h4><p>通过简单的主机探测、端口扫描、服务扫描与查点技术，我们知道了知道了当前所在网络中存在哪些类型的服务器，这些服务器上开放了哪些端口，这些端口上运行哪些服务以及具体的版本，此外利用口令猜测与嗅探，我们也获得了其中一台网关服务器的远程访问权。接下来扫描服务器存在哪些安全漏洞，以供进一步实施远程渗透攻击。</p>
<p>网络漏洞扫描指的是利用一些自动化的工具来发现网络上各类主机设备的安全漏洞。这些自动化的工具通常被称为漏洞扫描器。漏洞扫描通常可以分为“黑盒扫描”和“白盒扫描”。</p>
<p>漏洞扫描器在识别漏洞的过程中，会向目标发送大量的数据包，有时候甚至会导致目标系统拒绝服务或被扫描数据包阻塞，扫描行为几乎不可避免地会被对方的入侵检测设备发现；而且，漏洞扫描器扫描得出的结果通常会有很多的误报（报告发现漏洞实际漏洞并不存在）或是漏报（未报告发现漏洞但漏洞实际存在），因此需要对结果进行人工分析，确定哪些漏洞是实际存在的。</p>
<p>OpenVAS是类似Nessus的综合型漏洞扫描器，可以用来识别远程主机、Web应用存在的各种漏洞。在Nessus商业化不再开放源代码后，在它的原始项目中分支出OpenVAS开源项目。OpenVAS是当前最好用的开源漏洞扫描工具，它使用NVT（Network Vulnerabilty Test，网络漏洞测试）脚本对多种远程系统（包括Windows、Linux、UNIX以及Web应用程序等）的安全问题进行检测。OpenVAS开发组维护了一套免费的NVT库，并定期对其进行更新，以保证可以检测出最新的系统漏洞。</p>
<p>BT5中预装了OpenVAS网络漏洞扫描工具，只需要进一步配置OpenVAS（如果需要新安装OpenVas，可参考网络教程）：</p>
<p><strong>步骤1</strong>　首先，输入以下命令生成OpenVAS运行所需的证书文件，生成证书过程中，系统会询问一些信息，可以按回车键使用其默认值（第二条命令为OpenVAS manager创建了一个客户端证书）：<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">root@bt:~<span class="comment"># openvas-mkcert -q  </span></span><br><span class="line">root@bt:~<span class="comment"># openvas-mkcert-client -n om -i</span></span><br></pre></td></tr></table></figure></p>
<p><strong>步骤2</strong>　升级NVT库：<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">root@bt:~<span class="comment"># openvas-nvt-sync</span></span><br></pre></td></tr></table></figure></p>
<p>说明　也可以在BT5的菜单中选择Applications→BackTrack→Vulnerability Assessment→ Vulnerability Scanners→OpenVAS→OpenVAS NTV Sync。</p>
<p><strong>步骤3</strong>　对OpenVAS的扫描引擎进行一些初始化的操作，依次输入如下命令：<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">root@bt:~<span class="comment"># openvassd （启动“Start OpenVAS Scanner”加载）</span></span><br><span class="line">root@bt:~<span class="comment"># openvasmd --migrate  </span></span><br><span class="line">root@bt:~<span class="comment"># openvasmd --rebuild  （重建数据库）</span></span><br></pre></td></tr></table></figure></p>
<p><strong>步骤4</strong>　使用openvasad命令添加一个管理员角色的OpenVAS登录用户：<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">root@bt:~<span class="comment"># openvasad -c 'add_user' -n admin -r 'Admin'  </span></span><br><span class="line">Enter password:   </span><br><span class="line">admain:MESSAGE:2327:2011-10-21 03h37.44 EDT: No rules file provided, the new user will have no restrictions.  </span><br><span class="line">admain:MESSAGE:2327:2011-10-21 03h37.44 EDT: User admin has been successfully created.</span><br></pre></td></tr></table></figure></p>
<p><strong>步骤5</strong>　在终端中输入如下命令启动OpenVAS Scanner：<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">root@bt:~<span class="comment"># openvassd --listen=127.0.0.1 --port=9391 </span></span><br><span class="line">All plugins loaded</span><br></pre></td></tr></table></figure></p>
<p><strong>步骤6</strong>　最后启动OpenVAS Manager，在终端中运行如下命令：<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">root@bt:~<span class="comment"># openvasmd --database=/usr/local/var/lib/openvas/mgr/tasks.db --slisten=127.0.0.1 --sport=9391 --listen=0.0.0.0 --port=9390</span></span><br></pre></td></tr></table></figure></p>
<p>如果在启动OpenVAS各部件时报错，可以运行以下脚本确认OpenVAS已经安装配置无误，如果脚本运行后检测出错误，请按照屏幕提示进行修正。<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">root@bt:~<span class="comment"># /pentest/misc/openvas/openvas-check-setup</span></span><br></pre></td></tr></table></figure></p>
<p>以上命令可以通过openvassd -h查看具体解释（help）。<br>在执行openvassd -a 127.0.0.1 -p 9391时，遇到问题：bind() failed : Address already in use<br>通过 ps -e |grep openvassd  查看运行的进程然后kill -9 pid（进程号）或者killall openvas来终止相关进程解决。<br><strong>相关说明：</strong><br>ps是LINUX下最常用的也是非常强大的进程查看命令</p>
<blockquote>
<p>-e 显示所有进程。<br>-f 全格式。</p>
</blockquote>
<p>ps -e 列出程序时，显示每个程序所使用的环境变量。<br>ps -f 用ASCII字符显示树状结构，表达程序间的相互关系</p>
<p>grep命令是一种强大的文本搜索工具，它能使用正则表达式搜索文本，并把匹配的行打印出来。grep全称是Global Regular Expression Print，表示全局正则表达式版本，它的使用权限是所有用户。<br>ps -e | grep openvassd （检查httpd进程是否存在）</p>

            <div class="clearfix"></div>
            <hr class="nogutter">
        </div>
        <nav class="pagination" role="pagination">
    
    <a class="pull-left" href="/2016/04/08/Leetcode（1-10）/" style="float: left;">
        ← Leetcode（1-10）
    </a>
    
    
    <a class="pull-right" href="/2016/04/07/primer读书笔记（1）/">
        primer读书笔记（1） →
    </a>
    
</nav>

        <div class="duoshuo">
<div class="ds-thread" data-thread-key="2016/04/08/Metasplloith渗透测试/" data-title="Metasplloith渗透测试" data-url="https://github.com/CornFish98/CornFish98.github.io.git/2016/04/08/Metasplloith渗透测试/"></div>
<script type="text/javascript">
var duoshuoQuery = {short_name:"duoshuo_name"};
(function() {
	var ds = document.createElement('script');
	ds.type = 'text/javascript';ds.async = true;
	ds.src = (document.location.protocol == 'https:' ? 'https:' : 'http:') + '//static.duoshuo.com/embed.js';
	ds.charset = 'UTF-8';
	(document.getElementsByTagName('head')[0] 
	 || document.getElementsByTagName('body')[0]).appendChild(ds);
})();
</script>
</div>
    </div>
</section>


      
<!-- ============================ Footer =========================== -->

<footer>
    <div class="container">
            <div class="copy">
                <p>
                    &copy; 2014<script>new Date().getFullYear()>2010&&document.write("-"+new Date().getFullYear());</script>, Content By ZKY. All Rights Reserved.
                </p>
            </div>
            <div class="social">
                <ul>
                    
                    <li><a href="https://github.com/" title="Github" target="_blank"><i class="icon-github"></i></a>&nbsp;</li>
                    
                    
                    
                    
                    <li><a href="https://google.com/" title="Google-Plus" target="_blank"><i class="icon-google-plus"></i></a>&nbsp;</li>
                    
                    
                    <li><a href="http://weibo.com/" title="Sina-Weibo" target="_blank"><i class="icon-sina-weibo"></i></a>&nbsp;</li>
                    
                </ul>
            </div>
            <div class="clearfix"> </div>
        </div>
</footer>

<!-- ============================ END Footer =========================== -->
      <!-- Load our scripts -->
        
<!-- Resizable 'on-demand' full-height hero -->
<script type="text/javascript">
    
    var resizeHero = function () {
        var hero = $(".cover,.heightblock"),
            window1 = $(window);
        hero.css({
            "height": window1.height()
        });
    };
    
    resizeHero();
    
    $(window).resize(function () {
        resizeHero();
    });
</script>
<script src="/js/plugins.min.js"></script><!-- Bootstrap core and concatenated plugins always load here -->
<script src="/js/jquery.flexslider-min.js"></script><!-- Flexslider plugin -->
<script src="/js/scripts.js"></script><!-- Theme scripts -->

<!-- Initiate flexslider plugin -->
<script type="text/javascript">
    $(document).ready(function($) {
      $('.flexslider').flexslider({
        animation: "fade",
        prevText: "",
        nextText: "",
        directionNav: true
      });
    });
</script>

</body>
</html>
